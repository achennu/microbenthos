cls: &cls_schema
    required: true

entity_schema: &entity_schema
    cls:
        type: importpath
        <<: *cls_schema

    init_params:
        type: dict

variables: &var_schema
    cls:
        <<: *cls_schema
        allowed: [microbenthos.Variable, Variable]

    init_params:
        type: dict
        schema:

            name:
                type: symbolable
                min: 2
                required: true

            create:
                type: dict
                schema:
                    value:
                        type: [float, integer, physical_unit]
                        default: 0.0

                    unit:
                        type: unit_name

                    hasOld:
                        type: boolean
                        default: false

                    vtype:
                        type: string
                        allowed: ['cell', 'basic']
                        default: cell

            constraints:
                type: dict
                keyschema:
                    type: string
                    allowed: [top, bottom]
                valueschema:
                    type: [float, integer, physical_unit]


irradiance: &irradiance_schema
    cls:
        <<: *cls_schema
        allowed: [microbenthos.irradiance.Irradiance, Irradiance]

    init_params:
        schema:
            hours_total:
                type: float
                min: 5
                max: 48
            day_fraction:
                type: float
                min: 0.1
                max: 0.9
    channels:
        type: list
        schema:
            type: dict
            schema:
                name:
                    type: string
                    min: 2
                    required: true

                k0:
                    type: physical_unit
                    like_unit: 1/m

                k_mods:
                    type: list
                    schema:
                        items:
                            - type: string
                            - type: [physical_unit, float]

microbes: &microbes_schema
    cls:
        <<: *cls_schema
        allowed: [microbenthos.microbes.MicrobialGroup, MicrobialGroup]

    init_params:
        type: dict
        schema:
            name:
                type: string
                min: 2

    processes:
        type: dict
        keyschema:
            type: string
        schema:
            Qmax:
                type: physical_unit
                like_unit: mol/g/h

            responses:
                type: dict

processbase: &procbase
    type: dict
    keyschema:
        type: sympifyable
    valueschema: &procbase_value
        schema: &procbase_valueschema
            cls:
                <<: *cls_schema
                allowed: [ExprProcess, microbenthos.process.ExprProcess]

            init_params: &procbase_init
                type: dict

                schema: &procbase_initschema
                    formula:
                        type: sympifyable
                        required: true

                    varnames:
                        type: list
                        schema:
                            type: symbolable

                    params:
                        type: dict
                        keyschema:
                            type: symbolable

process: &process_schema
    <<: *procbase
    valueschema:
        <<: *procbase_value
        schema:
            <<: *procbase_valueschema
            init_params:
                <<: *procbase_init
                schema:
                    <<: *procbase_initschema
                    responses:  *procbase



model_schema:

    domain:
        type: dict
        schema:
            cls:
                <<: *cls_schema
                allowed: [microbenthos.SedimentDBLDomain, SedimentDBLDomain]

            init_params:
                type: dict
                schema:
                    cell_size:
                        type: physical_unit
                        like_unit: cm
                        required: true
                        default: !unit 100mum
                        min: !unit 1mum
                        max: !unit 500 mum

                    sediment_length:
                        type: physical_unit
                        like_unit: cm
                        required: true
                        default: !unit 10mm
                        min: !unit 1 mm

                    dbl_length:
                        type: physical_unit
                        like_unit: cm
                        required: true
                        default: !unit 1mm
                        min: !unit 0mm

                    porosity:
                        type: float
                        min: 0.1
                        max: 0.9
                        default: 0.6


    formulae:
        type: dict
        keyschema:
            type: sympifyable
        valueschema:
            schema:
                variables:
                    type: list
                    schema:
                        type: symbolable

                expr:
                    type: sympifyable


    environment:
        type: dict

        schema:
            irradiance:
                type: dict
                schema:
                    <<: *irradiance_schema

            chemicals:
                type: dict
                keyschema:
                    type: symbolable

                valueschema:
                    schema: *var_schema

            processes:
                <<: *process_schema





    microbes:
        type: dict
        keyschema:
            type: string






