domain:
    cls: SedimentDBLDomain
    init_params:
        cell_size: !unit 100 mum
        sediment_length: !unit 10 mm
        dbl_length: !unit 1 mm
        porosity: 0.6


environment:

    oxy:
        cls: Variable
        init_params:
            name: oxy
            create:
                hasOld: true
                value: !unit 0.0 mol/l

            constraints:
                top: !unit 0.2e-3 mol/l
                bottom: !unit 0 mol/l

    h2s:
        cls: Variable
        init_params:
            name: h2s
            create:
                hasOld: true
                value: !unit 0.0 mol/l

            constraints:
                top: !unit 0.0 mol/l
                bottom: !unit 1e-3 mol/l


    irradiance:
        cls: Irradiance
        init_params:
            hours_total: 24
            day_fraction: 0.3

        channels:
            - name: par
              k0: !unit 15.3 1/cm
              k_mods:
                - [cyano, 6523]
                - [cyano, 65253]
                - [cyano, !unit 125 g/mm**3]


    abiotic_h2s_oxidation:
        cls: ExprProcess
        init_params:
            formula: porosity * k * oxy**2 * h2s
            varnames: ['oxy', 'h2s', 'porosity']
            params:
                k: !unit '70 1/((10**-3)*mol/l)**2/h'
            responses:
                optimum(par):
                    cls: ExprProcess
                    init_params:
                        formula: optimum_response(par, Ks, Ki)
                        varnames:
                            - par
                        params:
                            Ks: 1
                            Ki: 10


microbes:
    cyano:
        init_params:
            name: cyano
            features:
                biomass:
                    init_params:
                        name: biomass
                        create:
                            value: !unit 0.0 g/cm**3

                        constraints:
                            dbl: !unit 0 g/cm**3

                BChla:
                    init_params:
                        name: BChla
                        create:
                            value: !unit 0.0 g/cm**3

            processes:
                oxyPS:
                    init_params:
                        formula: Qmax * biomass
                        varnames:
                            - biomass
                        params:
                            Qmax: !unit "0.00841 mol/g/h"

                        responses:
                            optimum(par):
                                cls: ExprProcess
                                init_params:
                                    formula: optimum_response(par, Ks, Ki)
                                    varnames:
                                        - par
                                    params:
                                        Ks: 1
                                        Ki: 10

                            optimum(oxy):
                                cls: ExprProcess
                                init_params:
                                    formula: inhibition_response(oxy, Kmax, Khalf)
                                    varnames:
                                        - oxy
                                    params:
                                        Kmax: !unit "0.8e-3 mol/l"
                                        Khalf: !unit "0.7e-3 mol/l"

formulae:
    optimum_response:
        variables: [x, Ks, Ki]
        expr: x/(x + Ks)/(1 + x/Ki)


    inhibition_response:
        variables: [x, Kmax, Khalf]
        expr: (Kmax - x) / (2*Kmax - Khalf - x) * (x < Kmax)

    saturation_response:
        variables: [x, Ks]
        expr: x / (Ks + x)
